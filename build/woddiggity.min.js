/*! woddiggity 2014-03-24 */
myControllers.controller("AccountCtrl",["$scope","$rootScope","Login",function(a,b,c){"use strict";function d(){return{email:b.ActiveUser.Email,oldpass:a.oldpass,newpass:a.newpass,confirm:a.confirm,callback:function(b){b?a.err=b:(a.oldpass=null,a.newpass=null,a.confirm=null,a.msg="Password updated!")}}}a.oldpass=null,a.newpass=null,a.confirm=null,a.reset=function(){a.err=null,a.msg=null},a.cancelChangePassword=function(){$("#change_password_text").show(),$("#change_password").hide()},a.updatePassword=function(){a.reset(),c.changePassword(d())}}]),myControllers.controller("ExerciseCtrl",["$scope","Exercise","angularGridService","ExerciseType",function(a,b,c,d){"use strict";function e(b){var c="";return $.each(a.typeList,function(a,d){return d._id===b?(c=d.Name,!1):!0}),c}a.exercise={},a.exerciseList=[],a.hasFormError=!1,a.typeList=[],d.query().then(function(b){a.typeList=b}),a.getListRecords=function(d){c.sortByColumn(b,a,"exerciseList","exercise",d)},a.sortByColumn=function(d){c.sortByColumn(b,a,"exerciseList","exercise",d),$("#exercise_form").hide()},a.setExerciseTypeIdsString=function(a){a.exercise.ExerciseTypeIdsString=e(a.exercise.ExerciseTypeId)},a.getExercise=function(c){b.get(c).then(function(b){a.exercise=b})},a.newExercise=function(){a.exercise=b.getNew(),$("#exercise_form").show()},a.editRecord=function(b){a.setActiveRow(b),a.editExercise()},a.editExercise=function(){var b=$("#exerciseTable").find("tr.info");if(0===b.length)alert("please select a row to edit");else{var c=b.attr("id").split("_")[1];a.getExercise(c),$("#exercise_form").show()}},a.deleteExercise=function(){var c=$("#exerciseTable").find("tr.info");if(0===c.length)alert("please select a row to edit");else{var d=c.attr("id").split("_")[1];b.remove(d).then(function(b){b.success?a.sortByColumn("Name","-"):alert(b)})}},a.saveExercise=function(){var c=null===a.exercise._id;a.exerciseForm.$invalid?a.hasFormError=!0:(c?b.insert(a.exercise).then(function(b){b.message?alert(b.message):a.sortByColumn("Name","-")}):b.update(a.exercise).then(function(b){b.success?a.sortByColumn("Name","-"):alert(b.message)}),$("#exercise_form").hide(),a.hasFormError=!1)},a.cancelExercise=function(){$("#exercise_form").hide()},a.setActiveRow=function(a){$("#exerciseTable").find("tr").removeClass("info"),$("#exercise_"+a.exercise._id).addClass("info")}}]),myControllers.controller("ExerciseTypeCtrl",["$scope","ExerciseType","angularGridService","UnitOfMeasure",function(a,b,c,d){"use strict";function e(b){var c="";return $.each(a.unitsList,function(a,d){return d._id===b?(c=d.Name,!1):!0}),c}function f(){$.each(a.unitsList,function(b,c){var d=$.grep(a.exerciseType.UnitOfMeasureIds,function(a){return a===c._id});c.selected=d.length>0?!0:!1})}a.hasFormError=!1,a.exercisTypeList=[],a.exerciseType={},d.query().then(function(b){a.unitsList=b}),a.toggleUnit=function(b){var c=a.exerciseType.UnitOfMeasureIds.indexOf(b.unit._id);c>-1?(a.exerciseType.UnitOfMeasureIds.splice(c,1),b.unit.selected=!1):(a.exerciseType.UnitOfMeasureIds.push(b.unit._id),b.unit.selected=!0)},a.getListRecords=function(d){c.sortByColumn(b,a,"exerciseTypeList","exerciseType",d)},a.sortByColumn=function(d){c.sortByColumn(b,a,"exerciseTypeList","exerciseType",d)},a.setUnitOfMeasureString=function(a){a.exerciseType.UnitOfMeasureIdString="",$.each(a.exerciseType.UnitOfMeasureIds,function(b,c){var d=a.exerciseType.UnitOfMeasureIdString.length>0?", ":"";a.exerciseType.UnitOfMeasureIdString+=d+e(c)})},a.saveExerciseType=function(){if(a.exerciseTypeForm.$invalid)a.hasFormError=!0;else{var c=null==a.exerciseType._id;c?b.insert(a.exerciseType).then(function(b){b.message?alert(b.message):a.sortByColumn("Name","-")}):b.update(a.exerciseType).then(function(b){b.success?a.sortByColumn("Name","-"):alert(b.message)}),a.hasFormError=!1,$("#exerciseType_form").hide()}},a.newExerciseType=function(){a.exerciseType=b.getNew(),f(),$("#exerciseType_form").show()},a.setActiveRow=function(a){$("#exerciseTypeTable").find("tr").removeClass("info"),$("#exerciseType_"+a.exerciseType._id).addClass("info")},a.getExerciseType=function(c){b.get(c).then(function(b){a.exerciseType=b,f()})},a.editRecord=function(b){a.setActiveRow(b),a.editExerciseType()},a.cancelExerciseType=function(){$("#exerciseType_form").hide()},a.editExerciseType=function(){var b=$("#exerciseTypeTable").find("tr.info");if(0===b.length)alert("please select a record to edit");else{var c=b.attr("id").split("_")[1];a.getExerciseType(c),$("#exerciseType_form").show()}},a.deleteExerciseType=function(){}}]),myControllers.controller("HomeCtrl",["$scope",function(){"use strict"}]),myControllers.controller("LoginCtrl",["$scope","Login","$location",function(a,b,c){"use strict";a.username=null,a.password=null,a.confirm=null,a.createMode=!1,a.login=function(){a.err=null,a.username?a.password?b.login(a).then(function(b){a.err=b.error?b.error+"":null,b.user&&c.path("/home")}):a.err="Please enter a password":a.err="Please enter an email address"}}]),myControllers.controller("PersonalCtrl",["$scope","$rootScope","$compile","Exercise","PersonalRecord","User",function(a,b,c,d,e,f){"use strict";function g(a,b){b.sort(a?function(a,b){return new Date(b.RecordDate)<new Date(a.RecordDate)}:function(a,b){return new Date(a.RecordDate)<new Date(b.RecordDate)})}function h(){$("#account_info_text").show(),$("#account_info").hide(),$("#change_password_text").show(),$("#change_password").hide(),$("#preferences_form_text").show(),$("#preferences_form").hide(),$("#box_info_text").show(),$("#box_info").hide(),$("#oneRepMaxEstimation_text").show(),$("#oneRepMaxEstimation_form").hide()}a.exerciseList=null,a.valuePlaceholder="Value",a.personalRecords=[],a.unitsList=[{name:"Kg"},{name:"Lbs"},{name:"Miles"},{name:"Meters"},{name:"Time"}],a.exerciseHistory=null,a.help={title:""},a.savePrError="",a.changePasswordError="",d.query().then(function(b){a.exerciseList=b}),a.getPersonalRecords=function(){e.query(b.ActiveUser._id,"ExerciseName").then(function(b){$.each(b,function(a){g(!1,b[a].History)}),a.personalRecords=b})},a.getNew=function(){a.getPersonalRecords(),a.newPR={RecordDate:null,Value:"",Units:"",UserId:b.ActiveUser._id,ExerciseId:"",ExerciseName:""}},a.onUnitSelected=function(a){a.newPR.Units=a.newPR.Unit.name},a.getSelectedUnit=function(b){b.Unit=a.unitsList[2]},a.onExerciseSelect=function(b){var c=b.newPR.Exercise;a.newPR.ExerciseId=c._id,a.newPR.ExerciseName=c.Name,"Weight"===c.Type&&(a.valuePlaceholder="Weight"),"Distance"===c.Type&&(a.valuePlaceholder="Distance")},a.savePR=function(){a.newPrForm.$invalid?a.prInvalid=!0:e.insert(a.newPR).then(function(){a.getNew(),a.prInvalid=!1,a.prInvalidDate=!1})},a.showAllPrs=function(a){$(".pr-history").hide(),$(".pr-summary").show(),$("#records_"+a.pr._id).toggle(),$("#history_"+a.pr._id).hide()},a.hidePrHistoryRecords=function(){$(".pr-history").hide(),$(".pr-summary").show()},a.hidePrChart=function(){$(".pr-chart").hide(),$(".pr-summary").show()},a.showHistory=function(b){a.exerciseHistory=b.pr;var c=$("#exerciseGraph_"+b.pr._id);$(".pr-history").hide(),$(".pr-summary").show(),$(".pr-chart").hide(),$("#chart_"+b.pr._id).show(),$("#history_"+b.pr._id).hide();var d=c.width(),e=function(a){var b=[];return g(!0,a),$.each(a,function(a,c){var d=new Date(c.RecordDate);b.push(d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear())}),b},f=function(a){var b=[];return g(!0,a),$.each(a,function(a,c){b.push(parseFloat(c.Value))}),b};c.highcharts({chart:{width:d},title:{text:""},xAxis:{categories:e(a.exerciseHistory.History)},yAxis:{title:"",plotLines:[{value:0,width:1,color:"#808080"}]},series:[{name:a.exerciseHistory.ExerciseName,data:f(a.exerciseHistory.History)}],legend:{enabled:!1},credits:{enabled:!1}}),g(!1,a.exerciseHistory.History)},a.setActiveRow=function(a){$(".diggity-table").find("tr").removeClass("info"),$("#history_"+a.pr._id).addClass("info")},a.editHistory=function(b){a.exerciseHistory=b.pr,$("#exerciseGraph").html($("<edit-pr-records></edit-pr-records>")),c($("#exerciseGraph").contents())(a),$("#myModal").modal("show")},a.showPrHelp=function(){a.help.title="Personal Records Help",$("#helpForm").html($("<pr-help></pr-help>")),c($("#helpForm").contents())(a),$("#helpModal").modal("show")},a.calculateOneRepMax=function(){var a=parseFloat($("#weight_lifted").val()),b=parseFloat($("#max_reps").val()),c=a*(1+b/30),d=5*Math.round(c/5);$("#estimated_max").val(d)},a.closeOneRepMaxForm=function(){$("#oneRepMaxEstimation_form").hide(),$("#oneRepMaxEstimation_text").show()},a.editAccountInfo=function(){h(),a.user={},$.extend(a.user,b.ActiveUser),$("#account_info").toggle(),$("#account_info_text").toggle()},a.saveAccountInfo=function(){f.update(a.user).then(function(c){c.error?a.accountInfoError=c.error:(b.ActiveUser=a.user,window.sessionStorage.setItem("woddo_user",JSON.stringify(b.ActiveUser)),$("#account_info_text").show(),$("#account_info").hide())})},a.cancelAccountInfo=function(){$("#account_info_text").show(),$("#account_info").hide(),console.log("cancel edit account info")},a.showChangePassword=function(){h(),a.changePasswordError="",a.changePassword={},$.extend(a.user,b.ActiveUser),$("#change_password_text").toggle(),$("#change_password").toggle()},a.showEstimationFormForm=function(){h(),$("#oneRepMaxEstimation_text").toggle(),$("#oneRepMaxEstimation_form").toggle()},a.showPreferencesForm=function(){h(),$("#preferences_form_text").toggle(),$("#preferences_form").toggle()},a.showBoxInfo=function(){h(),$("#box_info_text").toggle(),$("#box_info").toggle()}}]),myControllers.controller("UnitOfMeasureCtrl",["$scope","UnitOfMeasure","angularGridService",function(a,b,c){"use strict";a.hasFormError=!1,a.unitOfMeasureList=[],a.unitOfMeasure={},a.getListRecords=function(d){c.sortByColumn(b,a,"unitOfMeasureList","unitOfMeasure",d)},a.sortByColumn=function(d){c.sortByColumn(b,a,"unitOfMeasureList","unitOfMeasure",d)},a.saveUnitOfMeasure=function(){if(a.measureForm.$invalid)a.hasFormError=!0;else{var c=null===a.unitOfMeasure._id;c?b.insert(a.unitOfMeasure).then(function(b){b.message?alert(b.message):a.sortByColumn("Name","-")}):b.update(a.unitOfMeasure).then(function(b){b.success?a.sortByColumn("Name","-"):alert(b.message)}),a.hasFormError=!1,$("#unit-of-measure-form").hide()}},a.newUnitOfMeasure=function(){a.unitOfMeasure=b.getNew(),$("#unit-of-measure-form").show()},a.editRecord=function(b){a.setActiveRow(b),a.editUnitOfMeasure()},a.cancelUnitOfMeasure=function(){$("#unit-of-measure-form").hide()},a.getUnitOfMeasure=function(c){b.get(c).then(function(b){a.unitOfMeasure=b})},a.editUnitOfMeasure=function(){var b=$("#unitOfMeasureTable").find("tr.info");if(0===b.length)alert("please select a row to edit");else{var c=b.attr("id").split("_")[1];a.getUnitOfMeasure(c),$("#unit-of-measure-form").show()}},a.deleteUnitOfMeasure=function(){var c=$("#unitOfMeasureTable").find("tr.info");if(0===c.length)alert("please select a row to delete");else{var d=c.attr("id").split("_")[1];b.remove(d).then(function(b){b.success?a.sortByColumn("Name","-"):alert(b)})}},a.setActiveRow=function(a){$("#unitOfMeasureTable").find("tr").removeClass("info"),$("#unitOfMeasure_"+a.unitOfMeasure._id).addClass("info")}}]),myControllers.controller("UserCtrl",["$scope","$rootScope","$location","User",function(a,b,c,d){"use strict";a.confirmPassword="",a.user={_id:null,FirstName:"",LastName:"",Email:"",password:""},a.List=[],a.sortValues={name:"",direction:"",text:""},a.getListRecords=function(a){d.query(a)},a.createUser=function(){""===a.user.FirstName?a.err="Please enter a First Name":""===a.user.LastName?a.err="Please enter a Last Name":""===a.user.Email?a.err="Please enter an Email address":""===a.user.password?a.err="Please enter a Password":a.user.password!==a.confirmPassword?a.err="Password does not match Confirm Password":d.insert(a.user).then(function(d){d.errors?a.err=d.message:(window.sessionStorage.setItem("woddo_user",JSON.stringify(d)),b.ActiveUser=d,b.isAuthenticated=null!=b.ActiveUser,c.path("/home"))})}}]),myControllers.controller("WeightWorkoutCtrl",["$scope","WeightWorkout","Exercise","PersonalRecord",function(){"use strict"}]),myControllers.controller("WendlerCtrl",["$scope","WendlerWorkout","Exercise",function(a,b,c){"use strict";function d(){for(var a=[],b=1;4>b;b++)a.push(e(b));return a}function e(a){return{NumberOf:a,Reps:5,PercentMax:50,IsMaxEffort:!1}}function f(a){$.each(a.$parent.exercise.Sets,function(b){a.$parent.exercise.Sets[b].NumberOf=b+1})}function g(a,b,c){var d={};$.extend(d,a[b]),c?b>0&&(a.splice(b,1),a.splice(b-1,0,d)):b<a.length-1&&(a.splice(b,1),a.splice(b+1,0,d))}a.wendlerRecord={Weeks:[],ProgramType:"",Name:"",Description:""},a.existingWorkouts=[],a.exercises=[],a.workoutDays=[{name:2},{name:3},{name:4}],a.programTypes=[{name:"Four Weeks",number:4},{name:"Six Weeks",number:6}],c.query().then(function(b){a.exercises=b}),b.query().then(function(b){a.existingWorkouts=b}),a.sortByColumn=function(c){b.query(c).then(function(b){a.existingWorkouts=b})},a.setProgramType=function(b){a.wendlerRecord.ProgramType=b.ProgramType.name;for(var c=[],d=1;d<b.ProgramType.number+1;d++)c.push({Name:"Week "+d,Number:d,Days:null});a.wendlerRecord.Weeks=c,$("#days").removeAttr("disabled")},a.setWorkoutDay=function(b){$.each(a.wendlerRecord.Weeks,function(c){for(var e=[],f=1;f<b.NumberOfDays.name+1;f++){var g={Name:"Day "+f,DayNumber:f,Exercises:[{ExerciseId:"",Sets:d()}]};e.push(g)}a.wendlerRecord.Weeks[c].Days=e})},a.setMaxError=function(a){a.set.IsMaxEffort=!a.set.IsMaxEffort},a.moveExerciseUp=function(a,b){g(a.$parent.day.Exercises,b,!0)},a.moveExerciseDown=function(a,b){g(a.$parent.day.Exercises,b,!1)},a.addExercise=function(a){a.$parent.day.Exercises.push({ExerciseId:"",Sets:d()})},a.removeExercise=function(a,b){a.day.Exercises.length>1&&a.$parent.day.Exercises.splice(b,1)},a.moveSetUp=function(a,b){g(a.$parent.exercise.Sets,b,!0),f(a)},a.moveSetDown=function(a,b){g(a.$parent.exercise.Sets,b,!1),f(a)},a.addSet=function(a){var b=a.$parent.exercise.Sets.length+1;a.$parent.exercise.Sets.push(e(b))},a.removeSet=function(a,b){a.$parent.exercise.Sets.length>1&&(a.$parent.exercise.Sets.splice(b,1),f(a))},a.onExerciseSelect=function(a){var b=a.exercise.SelectedExercise;a.exercise.ExerciseId=b._id},a.setActiveRow=function(){},a.newWendler=function(){},a.editWendler=function(){},a.deleteWendler=function(){}}]),myControllers.controller("WodCtrl",["$scope","Exercise",function(){"use strict"}]);